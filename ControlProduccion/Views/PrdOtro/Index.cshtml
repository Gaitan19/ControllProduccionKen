@using Application.DTOs
@model IEnumerable<ShowPrdOtroDto>

@{
    ViewData["Title"] = "Produccion Otro";
}

<div class="col-md-15 offset-md-1">
    <h2 class="text-center"> @ViewData["Title"]</h2>
    <div class="ibox">
        <div class="ibox-title">

            <div class="col-sm-8">
                @if (User.IsInRole("JefeProduccion"))
                {
                    <a asp-controller="PrdOtro" asp-route-end="@DateTime.Now" asp-route-start="@DateTime.Now.AddDays(-1)" asp-action="GetDataReport" id="btnVerReporte" class="btn btn-info btn-outline">
                        <i class="fa fa-print"></i> Ver Reporte
                    </a>
                }

            </div>
        </div>
        <div class="ibox-content table-responsive">
            <table id="tblProduccion" class="table tdatatable2 table-bordered">
                <thead>
                    <tr>
                        <th>Id Produccion</th>
                        <th>Operario</th>
                        <th>Fecha</th>

                        <th>Validado</th>
                        <th>Aprobado</th>
                        @* <th>Accion</th> *@
                    </tr>
                </thead>
                <tbody>
                    @foreach (var produccion in Model)
                    {
                        <tr>
                            @if (User.IsInRole("Supervisor"))
                            {
                                <td>
                                    <a asp-action="Details" asp-route-id="@produccion.Id">
                                        @produccion.Id
                                    </a>
                                </td>
                            }
                            else if (User.IsInRole("JefeProduccion"))
                            {
                                <td>
                                    <a asp-action="Edit" asp-route-id="@produccion.Id">
                                        @produccion.Id
                                    </a>
                                </td>
                            }
                            else
                            {
                                <td>@produccion.Id</td>
                            }

                            <td>@produccion.Operarios</td>
                            <td>@produccion.Fecha.ToString("dd/MM/yyyy")</td>

                            @if (produccion.AprobadoSupervisor)
                            {
                                <td>
                                    <i class="fa fa-check text-success fa-2x"></i>
                                </td>
                            }
                            else
                            {
                                <td>
                                    @if (User.IsInRole("Supervisor"))
                                    {
                                        <button onclick="ValidarPrd(@produccion.Id)" class="btn btn-warning btn-sm">
                                            <i class="fa fa-check"></i> Validar
                                        </button>
                                    }
                                    else
                                    {
                                        <i class="fa fa-times text-danger fa-2x"></i>
                                    }
                                </td>
                            }

                            @if (produccion.AprobadoGerencia)
                            {
                                <td>
                                    <i class="fa fa-check text-success fa-2x"></i>
                                </td>
                            }
                            else
                            {
                                <td>
                                    @if (User.IsInRole("JefeProduccion"))
                                    {
                                        <button onclick="AprobarPrd(@produccion.Id)" class="btn btn-primary btn-sm">
                                            <i class="fa fa-check"></i> Aprobar
                                        </button>
                                    }
                                    else
                                    {
                                        <i class="fa fa-times text-danger fa-2x"></i>
                                    }
                                </td>
                            }

                            @* <td>
                                <a href="@Url.Action("Details", new { id = produccion.Id })" class="btn btn-info btn-sm">
                                    <i class="fa fa-eye"></i> Ver
                                </a>
                                @if (User.IsInRole("JefeProduccion"))
                                {
                                    <a href="@Url.Action("Edit", new { id = produccion.Id })" class="btn btn-warning btn-sm">
                                        <i class="fa fa-edit"></i> Editar
                                    </a>
                                }
                            </td> *@
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

@section Scripts {
    <script>

        function ValidarPrd(id) {
            swal({
                title: "¿Está Seguro?",
                text: "¿Desea Validar esta Producción?",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33",
                confirmButtonText: "Si, Validar!",
                cancelButtonText: "Cancelar"
            }).then((result) => {
                if (result.value) {
                    $.ajax({
                        url: '@Url.Action("ValidarPrd", "PrdOtro")',
                        type: 'POST',
                        data: { id: id },
                        headers: {
                            'RequestVerificationToken': $('input[name="__RequestVerificationToken"]').val()
                        },
                        success: function (response) {
                            if (response) {
                                swal("Validado!", "La producción ha sido validada.", "success").then(() => {
                                    location.reload();
                                });
                            } else {
                                swal("Error!", "No se pudo validar la producción.", "error");
                            }
                        },
                        error: function () {
                            swal("Error!", "Ocurrió un error al validar la producción.", "error");
                        }
                    });
                }
            });
        }

        function AprobarPrd(id) {
            swal({
                title: "¿Está Seguro?",
                text: "¿Desea Aprobar esta Producción?",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33",
                confirmButtonText: "Si, Aprobar!",
                cancelButtonText: "Cancelar"
            }).then((result) => {
                if (result.value) {
                    $.ajax({
                        url: '@Url.Action("AprobarPrd", "PrdOtro")',
                        type: 'POST',
                        data: { id: id },
                        headers: {
                            'RequestVerificationToken': $('input[name="__RequestVerificationToken"]').val()
                        },
                        success: function (response) {
                            if (response) {
                                swal("Aprobado!", "La producción ha sido aprobada.", "success").then(() => {
                                    location.reload();
                                });
                            } else {
                                swal("Error!", "No se pudo aprobar la producción.", "error");
                            }
                        },
                        error: function () {
                            swal("Error!", "Ocurrió un error al aprobar la producción.", "error");
                        }
                    });
                }
            });
        }

        $('.tdatatable2').DataTable({
            pageLength: 25,
            responsive: true,
            info: false,
            language: {
                search: '',
                searchPlaceholder: "Buscar...",
                emptyTable: "Sin Datos"
            },
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
}